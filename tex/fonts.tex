\defaultfontfeatures{ 
  Path = fonts/ ,
  Scale=MatchLowercase,
}

% 
% Text fonts
%

\setmainfont{Alegreya}[
  Extension=.otf,
  ItalicFont=*-Italic,
  BoldFont=*-Bold,
  BoldItalicFont=*-BoldItalic,
  BoldFeatures={SmallCapsFont=*SC-Bold},
  SmallCapsFont=*SC-Regular,
  SmallCapsFeatures={%
    LetterSpace=10,
    WordSpace=2.5
  },
  SlantedFont = Alegreya,
  SlantedFeatures={FakeSlant=0.13},
  Scale = 0.93925
]
\setsansfont{AlegreyaSans}[
  Extension=.otf,
  UprightFont=*-Regular,
  ItalicFont=*-Italic,
  BoldFont=*-Bold,
  BoldFeatures={SmallCapsFont=*SC-Bold},
  BoldItalicFont=*-BoldItalic,
  SmallCapsFont=*SC-Regular,
  SmallCapsFeatures={%
    LetterSpace=10,
    WordSpace=3
  },
]
\newfontfamily{\letterspacefont}{AlegreyaSans}[
  Extension=.otf,
  UprightFont=*-ExtraBold,
  ItalicFont=*-Italic,
  BoldFont=*-Black,
  BoldItalicFont=*-BoldItalic,
  LetterSpace=15,
  WordSpace=4
]
\newfontfamily{\tablefont}{AlegreyaSans}[
  Extension=.otf,
  UprightFont=*-Regular,
  ItalicFont=*-Italic,
  BoldFont=*-Bold,
  BoldItalicFont=*-BoldItalic,
  Numbers={Monospaced,Lining}
]
\newfontfamily{\greekfont}{Alegreya}[
  Script=Latin,
  Extension=.otf,
]

% 
% Math fonts
%

\usepackage{unicode-math}

\setmathfont{STIX2Math}[% operators
  Extension = .otf ,
  StylisticSet = 01 ,
  Scale=MatchLowercase,
]

\setmathfont{Alegreya.otf}[% numbers
  range = {up},
  Script=Latin,
  script-features={},
  sscript-features={}
]

\setmathfont{Alegreya-Italic.otf}[% italic letters
  range = {it},
  Script=Latin,
  script-features={},
  sscript-features={}
]

%% Alllow cyrilic letters in math
\DeclareSymbolFont{cyrletters}{\encodingdefault}{\familydefault}{m}{it}
%% All letters
\newcommand{\makecyrmathletter}[1]{%
  \begingroup\lccode`a=#1\lowercase{\endgroup
  \Umathcode`a}="0 \csname symcyrletters\endcsname\space #1
}
\count255="409
\loop\ifnum\count255<"44F
  \advance\count255 by 1
  \makecyrmathletter{\count255}
\repeat

%% Fake slant fot г, д, п, т

\DeclareSymbolFont{cyrletterssl}{\encodingdefault}{\familydefault}{m}{sl}
\newcommand{\makecyrmathlettersl}[1]{%
  \begingroup\lccode`a=#1\lowercase{\endgroup
  \Umathcode`a}="0 \csname symcyrletterssl\endcsname\space #1
}
\makecyrmathlettersl{"433} % г
\makecyrmathlettersl{"434} % д
\makecyrmathlettersl{"43F} % п
\makecyrmathlettersl{"442} % т
